---
import { getCollection } from 'astro:content';
import CVLayout from '@/layouts/CVLayout.astro';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project }
  }));
}

const { project } = Astro.props;
const { Content } = await project.render();

// Get related projects (same category, excluding current)
const allProjects = await getCollection('projects');
const relatedProjects = allProjects
  .filter(p => p.slug !== project.slug && p.data.category === project.data.category)
  .slice(0, 3);
---

<CVLayout 
  title={`${project.data.title} - Vladimir Nasalciuc`}
  description={project.data.description}
>
  <!-- Project Header -->
  <div class="header">
    <div class="project-breadcrumb">
      <a href="/projects" class="breadcrumb-link">â† Back to Projects</a>
    </div>
    <h1>{project.data.title}</h1>
    <div class="subtitle">{project.data.category}</div>
    <div class="profile-summary">
      {project.data.description}
    </div>
  </div>

  <!-- Project Meta Information -->
  <div class="content-section">
    <h2>Project Details</h2>
    <div class="project-meta-grid">
      <div class="meta-item">
        <h4>ğŸ“… Timeline</h4>
        <p>{project.data.period}</p>
      </div>
      <div class="meta-item">
        <h4>ğŸš€ Status</h4>
        <span class={`status-badge status-${project.data.status.toLowerCase().replace(/\s+/g, '-')}`}>
          {project.data.status}
        </span>
      </div>
      <div class="meta-item">
        <h4>ğŸ·ï¸ Category</h4>
        <p>{project.data.category}</p>
      </div>
      {project.data.github && (
        <div class="meta-item">
          <h4>ğŸ”— Repository</h4>
          <a href={project.data.github} class="github-link" target="_blank" rel="noopener">
            View on GitHub â†’
          </a>
        </div>
      )}
    </div>
  </div>

  <!-- Technologies Used -->
  <div class="content-section">
    <h2>Technologies & Tools</h2>
    <div class="tech-tags">
      {project.data.technologies.map((tech) => (
        <span class="tech-tag">{tech}</span>
      ))}
    </div>
  </div>

  <!-- Project Content -->
  <div class="content-section">
    <div class="project-content">
      <Content />
    </div>
  </div>

  <!-- Related Projects -->
  {relatedProjects.length > 0 && (
    <div class="content-section">
      <h2>Related Projects</h2>
      <div class="related-projects">
        {relatedProjects.map((relatedProject) => (
          <div class="related-project-card">
            <h4>
              <a href={`/projects/${relatedProject.slug}`}>
                {relatedProject.data.title}
              </a>
            </h4>
            <p>{relatedProject.data.description}</p>
            <div class="tech-tags">
              {relatedProject.data.technologies.slice(0, 3).map((tech) => (
                <span class="tech-tag small">{tech}</span>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  )}

  <!-- Navigation -->
  <div class="content-section">
    <div class="project-navigation">
      <a href="/projects" class="nav-btn secondary">
        â† All Projects
      </a>
      <a href="/contact" class="nav-btn primary">
        Discuss This Project â†’
      </a>
    </div>
  </div>
</CVLayout>